/**!
 * Brickfolio - A jQuery plugin for equally spaced grid layouts
 * @version 0.0.1
 * @link https://github.com/fooplugins/brickfolio
 * @copyright Steven Usher & Brad Vincent 2014
 * @license Released under the GPL license.
 * You are free to use Brickfolio in personal projects as long as this copyright header is left intact.
 */
(function(t){function e(i,o){if(!(this instanceof e))return new e(i,o);var n=this,s={};return n.defaults={animation:"",itemSelector:"> .bf-item",imageSelector:"> img:first",gutter:40,responseTime:100,hideErrors:!1,loadTime:0,classes:{container:"brickfolio",loaded:"bf-loaded",item:"bf-item",error:"bf-error"}},n.$el=t(i),n.options=t.extend(!0,n.defaults,o),s.layout=null,s.timer=null,s.isIE=null,s.damnYouIE=function(t){null==s.isIE&&(s.isIE=window.navigator.userAgent.indexOf("MSIE ")>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)),1==s.isIE&&t.attr("src",t.attr("src"))},s.supportsAnimation=function(){var t,e=document.body||document.documentElement,i=e.style,o="animation";if("string"==typeof i[o])return!0;t=["Moz","Webkit","Khtml","O","ms"],o=o.charAt(0).toUpperCase()+o.substr(1);for(var n=0;t.length>n;n++)if("string"==typeof i[t[n]+o])return!0;return!1},s.init=function(){"static"==n.$el.css("position")&&n.$el.css("position","relative"),n.$el.addClass(n.options.classes.container).css("overflow","hidden"),s.supportsAnimation()&&n.$el.addClass(n.options.animation);var e=n.$el.find(n.options.itemSelector).addClass(n.options.classes.item).css({position:"absolute",display:"inline-block",margin:0,visibility:"hidden"});return e.length>0&&n.wait(e).always(function(){t(window).on("resize.brickfolio",function(){null!=s.timer&&clearTimeout(s.timer),s.timer=setTimeout(function(){s.timer=null,n.layout(e)},n.options.responseTime)}),n.layout(e),e.css("visibility","visible"),n.$el.addClass(n.options.classes.loaded)}),n},n.reinit=function(e){t(window).off("resize.brickfolio"),n.$el.removeClass([n.options.animation,n.options.classes.loaded].join(" ")).find(n.options.itemSelector).removeClass([n.options.classes.loaded,n.options.classes.error].join(" ")),n.options=t.extend(!0,n.options,e),s.init()},n.wait=function(e){var i=[];return e.each(function(){var e=t(this),o=e.find(n.options.imageSelector);i.push(new t.Deferred(function(t){setTimeout(function(){if(0==o.length)t.resolve();else if(1==o.get(0).complete){var i=o.get(0);"naturalHeight"in i&&"naturalWidth"in i&&0==i.naturalHeight&&0==i.naturalWidth?(n.options.hideErrors&&e.hide(),e.addClass(n.options.classes.error),t.reject()):(e.addClass(n.options.classes.loaded),t.resolve())}else o.on({"load.brickfolio":function(){o.off(".brickfolio"),e.addClass(n.options.classes.loaded),t.resolve()},"error.brickfolio":function(){o.off(".brickfolio"),n.options.hideErrors&&e.hide(),e.addClass(n.options.classes.error),t.reject()}}),s.damnYouIE(o)},n.options.loadTime)}))}),t.when.apply(t,i)},n.layout=function(e){var i=e.first(":not(."+n.options.classes.error+")").outerWidth(),o=n.$el.width(),r=parseInt(n.$el.css("paddingLeft")),l=parseInt(n.$el.css("paddingTop")),a={height:0,outer:0},u=[],h=n.options.gutter,c=l,d=Math.floor(o/i);d=Math.floor((o-(d-1)*n.options.gutter)/i),n.options.hideErrors&&(e=e.not("."+n.options.classes.error)),e.each(function(e){var s=t(this),l=n.getHeights(s);0==e%d?(u.length>0&&(h=n.update(u,a.height,i,o,d,h,c,r),c+=a.outer+n.options.gutter),u.length=0,a=l,u.push(s)):(a=l.height>a.height?l:a,u.push(s))}),n.update(u,a.height,i,o,d,h,c,r),c+=a.outer-l,n.$el.height(c),s.layout&&clearTimeout(s.layout),s.layout=setTimeout(function(){o!=n.$el.width()&&n.layout(e)},1e3)},n.update=function(t,e,i,o,s,r,l,a){if(0==t.length)return r;var u=s>t.length||2>=t.length,h=o-t.length*i;if(1==t.length)n.setHeights(t[0],e),a+=h/2,t[0].css({top:l,left:a});else{r=u?r:Math.floor(h/(t.length-1)),a+=u?Math.floor((h-(t.length-1)*r)/2):0;for(var c=0;t.length>c;c++)n.setHeights(t[c],e),t[c].css({top:l,left:a+i*c+r*c})}return r},n.setHeights=function(t,e){void 0==t.data("brickfolio_height")&&t.data("brickfolio_height",{height:t.height(),outer:t.outerHeight()}),t.height(e)},n.getHeights=function(t){return void 0==t.data("brickfolio_height")?{height:t.height(),outer:t.outerHeight()}:t.data("brickfolio_height")},s.init()}t.fn.brickfolio=function(t){return this.each(function(){this.__brickfolio__?this.__brickfolio__.reinit(t):this.__brickfolio__=new e(this,t)})}})(jQuery);